<html>
    <head>
    <title>One or Two features</title>
    <link href="http://getbootstrap.com/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="http://getbootstrap.com/examples/jumbotron-narrow/jumbotron-narrow.css" rel="stylesheet">
    <SCRIPT language="javascript" type="text/javascript" src="../static/js/jquery-3.2.0.min.js"></SCRIPT>

    <style>
        <!--canvas {-->
            <!--width: 42.5%;-->
            <!--height: 10;-->
            <!--width: auto\9; /* ie8 */-->
            <!--margin-left: 6.5%-->
        <!--}-->

        <!--#container {-->
          <!--display: flex;                  /* establish flex container */-->
          <!--flex-direction: row;            /* default value; can be omitted */-->
          <!--flex-wrap: nowrap;              /* default value; can be omitted */-->
          <!--justify-content: space-around; /* switched from default (flex-start, see below) */-->
        <!--}-->
        container {
          width: 100%;
          height: 10
          margin: 0px;
          border: 0;
          overflow: hidden; /*  Disable scrollbars */
          display: block;  /* No floating content on sides */
        }
        img {
            max-width: 100%;
            height: auto;
            width: auto\9; /* ie8 */
            margin-left: 0%
            margin-right: 1%
        }
    </style>
    </head>
    <body>
        <div class="header">
            <h3 class="text-muted">{{session['feature1']}} VS {{session['feature2']}}</h3>
        </div>
        <form action="/double" method="POST" name="location" onsubmit="return double.reload()">
            <label>Chromosome: {{session['chr']}}</label>
            <br>
            <label>Start: {{session['start']}}</label>
            <br>
            <label>End: {{session['end']}}</label>
            <br>
            <label>Chromosome:</label>
            <input type="text" name="chr" id="chr" maxlength="30" value="" placeholder="{{session['chr']}}" />
            <br>
            <label>Start:</label>
            <input type="number" name="start" id="start" maxlength="30" value="" placeholder="{{session['start']}}" />
            <br>
            <label>End:</label>
            <input type="number" name="end" id="end" maxlength="30" value="" placeholder="{{session['end']}}" />
            <br>
            <input type = "submit" name="submit" />
            &nbsp;
            <br>
            <br>
            <label>zoom in</label>&nbsp;
            <input type="submit" name="L1.5x" id="L1.5x" maxlength="30" value="L1.5x">
            <input type="submit" name="L3x" id="L3x" maxlength="30" value="L3x">
            <input type="submit" name="L10x" id="L10x" maxlength="30" value="L10x">
            &nbsp;
            <br>
            <label>zoom out</label>&nbsp;
            <input type="submit" name="S1.5x" id="S1.5x" maxlength="30" value="S1.5x">
            <input type="submit" name="S3x" id="S3x" maxlength="30" value="S3x">
            <input type="submit" name="S10x" id="S10x" maxlength="30" value="S10x">
        </form>
        <div id="container" style="clear: both">
            <h3 class="text-muted" style='float: left; margin-left:22.5%'>{{session['feature1']}}</h3>
            <h3 class="text-muted" style='float: right; margin-right:20%'>{{session['feature2']}}</h3>
        </div>
        <div id="canvas_container" style="clear: both">
            <canvas id="canvas1" style='float: left;border:1px solid #d3d3d3;'></canvas>
            <canvas id="canvas2" style='float: right;border:1px solid #d3d3d3;'></canvas></div>
        </div>

        <div>
            <div class="box" id="ifr1">
                <img src={{session['src1']}} width="49%" height="512" align="left"/>
            </div>

            <div class="box" id="ifr2" >
                <img src={{session['src2']}} width="49%" height="512" align="left"/>
            </div>
        </div>

        <br clear="all" />
        <footer class="footer">
            <p>&copy; Kaifu Chen lab 2017, Houston Methodist</p>
        </footer>

        <SCRIPT>
            var rect = (function () {

                // constructor
                function rect(id, x, y, width, height, fill, stroke, strokewidth, ctx) {
                    this.x = x;
                    this.y = y;
                    this.id = id;
                    this.width = width;
                    this.height = height;
                    this.fill = fill || "blue";
                    this.stroke = stroke || "blue";
                    this.ctx = ctx
                    this.strokewidth = strokewidth || 2;
                    this.redraw(this.x, this.y);
                    return (this);
                }
                rect.prototype.redraw = function (x, y) {
                    this.x = x || this.x;
                    this.y = y || this.y;
                    this.draw(this.stroke, this.ctx);
                    return (this);
                }
                //
                rect.prototype.highlight = function (x, y) {
                    this.x = x || this.x;
                    this.y = y || this.y;
                    this.draw("orange", this.ctx);
                    return (this);
                }
                //
                rect.prototype.draw = function (stroke, ctx) {
                    ctx.save();
                    ctx.beginPath();
                    ctx.fillStyle = this.fill;
                    ctx.strokeStyle = stroke;
                    ctx.lineWidth = this.strokewidth;
                    ctx.rect(this.x, this.y, this.width, this.height);
                    ctx.stroke();
                    ctx.fill();
                    ctx.restore();
                }
                //
                rect.prototype.isPointInside = function (x, y) {
                    return (x >= this.x && x <= this.x + this.width && y >= this.y && y <= this.y + this.height);
                }
                return rect;
            })();

            //
            function handleMouseDown(e) {
                mouseX = parseInt(e.pageX - e.data.offsetX);
                mouseY = parseInt(e.pageY - e.data.offsetY);

                // Put your mousedown stuff here
                var clicked = "";
                for (var i = 0; i < e.data.rects.length; i++) {
                    if (e.data.rects[i].isPointInside(mouseX, mouseY)) {
                        clicked += e.data.rects[i].id + " "
                    }
                }
                if (clicked.length > 0) {
                    alert("Clicked rectangles: " + clicked);
                }
            }

            //
            function handleMouseMove(e) {
                mouseX = parseInt(e.clientX - e.data.offsetX);
                mouseY = parseInt(e.clientY - e.data.offsetY);

                // Put your mousemove stuff here
                e.data.ctx.clearRect(0, 0, e.data.canvas.width, e.data.canvas.height);
                for (var i = 0; i < e.data.rects.length; i++) {
                    if (e.data.rects[i].isPointInside(mouseX, mouseY)) {
                        e.data.rects[i].highlight();
                    } else {
                        e.data.rects[i].redraw();
                    }
                }
            }

            <!--function canvasReSize(c) {-->
                <!--initialize();-->
                <!--function initialize(){-->
                    <!--window.addEventListener('resize', resizeCanvas, false);-->
                    <!--resizeCanvas();-->
                <!--}-->

                <!--function redraw() {-->
                    <!--context.strokeStyle = 'blue';-->
                    <!--context.lineWidth = '5';-->
                    <!--context.strokeRect(0, 0, window.innerWidth, window.innerHeight);-->
			    <!--}-->
                <!--function resizeCanvas() {-->
                    <!--c.width = window.innerWidth;-->
                    <!--c.height = window.innerHeight;-->
                    <!--redraw();-->
			    <!--}-->
            <!--}-->




            var canvas1 = document.getElementById("canvas1");
            canvas1.width = window.innerWidth*0.424;
            canvas1.height = 10;
            canvas1.style.marginLeft = window.innerWidth*0.065

            var ctx1 = canvas1.getContext("2d");
            var canvasOffset1 = $("#canvas1").offset();
            var offsetX1 = canvasOffset1.left;
            var offsetY1 = canvasOffset1.top;

            //

            var peaks1 = JSON.parse("{{session['peaks1']}}");

            var rects1 = [];
            for (i=0; i < peaks1.length;i++){
                if (peaks1[i][4] == 1){
                    var color = "red";
                } else {
                    var color = "blue";
                }
                rects1.push(new rect("{{session['chr']}}"+"_"+peaks1[i][0].toString()+"_"+peaks1[i][1].toString(), peaks1[i][2]*canvas1.width, 0, peaks1[i][3]*canvas1.width, 10, color, "black", 1, ctx1));
            }
            //
            //
            $("#canvas1").click({offsetX:offsetX1, offsetY:offsetY1, rects:rects1}, handleMouseDown);
            $("#canvas1").mousemove( {offsetX:offsetX1, offsetY:offsetY1, rects:rects1, ctx:ctx1, canvas:canvas1}, handleMouseMove);

            var canvas2 = document.getElementById("canvas2");

            canvas2.width = window.innerWidth*0.424;
            canvas2.height = 10;
            canvas2.style.marginRight = window.innerWidth*0.019

            var ctx2 = canvas2.getContext("2d");
            var canvasOffset2 = $("#canvas2").offset();
            var offsetX2 = canvasOffset2.left;
            var offsetY2 = canvasOffset2.top;

            var peaks2 = JSON.parse("{{session['peaks2']}}");

            var rects2 = [];
            for (i=0; i < peaks2.length;i++){
                if (peaks2[i][4] == 1){
                    var color = "red";
                } else {
                    var color = "blue";
                }
                rects2.push(new rect("{{session['chr']}}"+"_"+peaks2[i][0].toString()+"_"+peaks2[i][1].toString(), peaks2[i][2]*canvas2.width, 0, peaks2[i][3]*canvas2.width, 10, color, "black", 1, ctx2));
            }

            $("#canvas2").click({offsetX:offsetX2, offsetY:offsetY2, rects:rects2}, handleMouseDown);
            $("#canvas2").mousemove( {offsetX:offsetX2, offsetY:offsetY2, rects:rects2, ctx:ctx2, canvas:canvas2}, handleMouseMove);




        </SCRIPT>
    </body>
</html>